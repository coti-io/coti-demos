[dotenv@17.2.3] injecting env (15) from client/.env -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
============================================================
COTI VOTING CONTRACT - INTEGRATION TEST
============================================================

TEST 1: Check Initial Election Status
------------------------------------------------------------
‚úì Election is open: true
‚úì Voter count: 5
‚úì Owner: 0xe45FC1a7D84e73C8c71EdF2814E7467F7C86a8A2

TEST 2: Cast Votes
------------------------------------------------------------
Casting vote for Bob (option 1)...
‚úì Bob voted successfully (tx: 0x3715d378...)
  - Has voted: true
  - Authorized owner: true
Casting vote for Bea (option 2)...
‚úì Bea voted successfully (tx: 0x6daf4d3c...)
  - Has voted: true
  - Authorized owner: true
Casting vote for Charlie (option 1)...
‚úì Charlie voted successfully (tx: 0x51aec04f...)
  - Has voted: true
  - Authorized owner: true
Casting vote for David (option 3)...
‚úì David voted successfully (tx: 0x39ce54a7...)
  - Has voted: true
  - Authorized owner: true
Casting vote for Ethan (option 1)...
‚úì Ethan voted successfully (tx: 0x22bcaa2b...)
  - Has voted: true
  - Authorized owner: true

TEST 3: Verify All Votes Cast
------------------------------------------------------------
‚úì Total votes cast: 5/5

TEST 4: Close Election
------------------------------------------------------------
Closing election...
‚úì Election is now closed: true

TEST 5: Get Results (Aggregate and Decrypt)
------------------------------------------------------------
Calling getResults() - this will aggregate and decrypt votes...
Transaction sent: 0xb5c25493bd232a7199071dbed29758b828c75217a447b55e0918f531327fa72d
‚úì Results transaction confirmed (block 4208459)
  Status: SUCCESS

Reading decrypted results...
‚ùå Error getting results: missing revert data (action="call", data=null, reason=null, transaction={ "data": "0x4717f97c", "from": "0xe45FC1a7D84e73C8c71EdF2814E7467F7C86a8A2", "to": "0x8001Cc1c750c5b6DAE029e116cb8f61A2CF36f59" }, invocation=null, revert=null, code=CALL_EXCEPTION, version=6.15.0)
Fatal error: Error: missing revert data (action="call", data=null, reason=null, transaction={ "data": "0x4717f97c", "from": "0xe45FC1a7D84e73C8c71EdF2814E7467F7C86a8A2", "to": "0x8001Cc1c750c5b6DAE029e116cb8f61A2CF36f59" }, invocation=null, revert=null, code=CALL_EXCEPTION, version=6.15.0)
    at makeError (/Users/percival.lucena/coti/demo/vote/node_modules/ethers/lib.commonjs/utils/errors.js:137:21)
    at getBuiltinCallException (/Users/percival.lucena/coti/demo/vote/node_modules/ethers/lib.commonjs/abi/abi-coder.js:105:37)
    at AbiCoder.getBuiltinCallException (/Users/percival.lucena/coti/demo/vote/node_modules/ethers/lib.commonjs/abi/abi-coder.js:206:16)
    at JsonRpcProvider.getRpcError (/Users/percival.lucena/coti/demo/vote/node_modules/ethers/lib.commonjs/providers/provider-jsonrpc.js:695:43)
    at /Users/percival.lucena/coti/demo/vote/node_modules/ethers/lib.commonjs/providers/provider-jsonrpc.js:302:45
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5) {
  code: 'CALL_EXCEPTION',
  action: 'call',
  data: null,
  reason: null,
  transaction: {
    to: '0x8001Cc1c750c5b6DAE029e116cb8f61A2CF36f59',
    data: '0x4717f97c',
    from: '0xe45FC1a7D84e73C8c71EdF2814E7467F7C86a8A2'
  },
  invocation: null,
  revert: null,
  shortMessage: 'missing revert data',
  info: {
    error: { code: -32000, message: 'execution reverted' },
    payload: { method: 'eth_call', params: [Array], id: 157, jsonrpc: '2.0' }
  }
}
